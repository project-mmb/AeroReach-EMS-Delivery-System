<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AeroReach â€” Emergency Assistant</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  body{
    margin:0;
    font-family:'Inter',sans-serif;
    background:#e6eeff;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
  }

  .chat-box{
    width:95%;
    max-width:480px;
    background:white;
    padding:16px;
    border-radius:18px;
    box-shadow:0 12px 28px rgba(0,0,0,.08);
    height:90vh;
    display:flex;
    flex-direction:column;
  }

  .chat-area{
    flex:1;
    overflow-y:auto;
    padding-right:4px;
  }

  .msg{
    max-width:80%;
    padding:12px 14px;
    border-radius:14px;
    margin:6px 0;
    font-size:14px;
  }

  .ai{ 
    background:#f1f5fb;
    color:#1f2937;
    align-self:flex-start;
  }

  .choice{
    background:#2563eb;
    color:white;
    align-self:flex-start;
    padding:10px 14px;
    font-weight:500;
    cursor:pointer;
    border-radius:12px;
    margin:6px 0;
    font-size:14px;
  }

  .choice:hover{
    background:#1d4ed8;
  }
</style>
</head>

<body>

<div class="chat-box">
  <div id="chat" class="chat-area"></div>
</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* --- FIREBASE CONFIG --- */
const config={
 apiKey:"AIzaSyDgEH4QnHBLWzg54MNexYZJaATpRHFC_DA",
 authDomain:"aeroreach-5d4ae.firebaseapp.com",
 databaseURL:"https://aeroreach-5d4ae-default-rtdb.firebaseio.com",
 projectId:"aeroreach-5d4ae",
 storageBucket:"aeroreach-5d4ae.appspot.com",
 messagingSenderId:"477756305528",
 appId:"1:477756305528:web:470f50f591bee98e3e3d8d"
};

firebase.initializeApp(config);
const db=firebase.database();

/* --- USER AUTH --- */
const uid = localStorage.getItem("uid");
if(!uid){ window.location="signup.html"; }

/* --- PAGE ELEMENTS --- */
const chat=document.getElementById("chat");

/* --- STATE --- */
let step=0;
let emergency={};

/* --- UI FUNCTIONS --- */
function ai(msg){
  const d=document.createElement("div");
  d.className="msg ai";
  d.innerText=msg;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

function option(text, callback){
  const btn=document.createElement("div");
  btn.className="choice";
  btn.innerText=text;
  btn.onclick=callback;
  chat.appendChild(btn);
  chat.scrollTop=chat.scrollHeight;
}

/* --- STEP LOGIC --- */
function start(){
  ai("Hello ðŸ’™ I am AeroReach Emergency Assistant.");
  ai("Please tell me what kind of emergency you have.");

  step=1;
  showTypeOptions();
}

function showTypeOptions(){
  ["Injury","Bleeding","Asthma","GBV","Medication Refill","Postpartum"].forEach(type=>{
    option(type,()=>selectType(type));
  });
}

function selectType(type){
  emergency.type=type;
  ai("Thank you. Are you currently safe?");
  step=2;

  option("Yes, I am safe",()=>selectSafety("Safe"));
  option("No, I feel unsafe",()=>selectSafety("Unsafe"));
}

function selectSafety(val){
  emergency.safety=val;
  ai("Understood. Please allow GPS to dispatch help.");
  step=3;

  option("ðŸ“ Share GPS Location",()=>getGPS());
}

function getGPS(){
  navigator.geolocation.getCurrentPosition(async pos=>{
    emergency.gps={
      lat:pos.coords.latitude,
      lng:pos.coords.longitude
    };

    ai("âœ” GPS received. Dispatching drone...");
    await save();

  },()=>{
    ai("â— I couldn't get your location. Please try again.");
  });
}

async function save(){
  const ref=db.ref("alerts").push();
  await ref.set({
    userId:uid,
    emergencyType:emergency.type,
    safety:emergency.safety,
    gpsLocation:emergency.gps,
    createdAt:Date.now(),
    status:"Pending"
  });

  ai("ðŸš Your emergency has been logged.");
  ai("Help is on the way.");

  setTimeout(()=>{ window.location="drone.html"; },2000);
}

/* --- START CHAT --- */
start();
</script>

</body>
</html>
